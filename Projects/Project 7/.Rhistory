geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = "bottom") +
ggtitle('Synthetic Controls for State Medicaid Expansion') +
xlab('Time') +
ylab('Uninsured Estimate')
# ---------
no_pool_synsum_filt_att <- as.data.frame(no_pool_synsum$att) %>% filter(Level %in% c("Hawaii", "California", "Louisiana", "Florida", "Montana", "Vermont"))
no_pool_synsum_filt_att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = "bottom") +
ggtitle('Synthetic Controls for State Medicaid Expansion') +
xlab('Time') +
ylab('Uninsured Estimate')
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ Adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 2,
time_cohort = TRUE)           # time cohort set to TRUE
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 2,
time_cohort = TRUE)           # time cohort set to TRUE
# save summary
ppool_syn_time_summ <- summary(ppool_syn_time)
ppool_syn_time_summ_att <- as.data.frame(ppool_syn_time_summ$att) %>% filter(Level %in% c("Hawaii", "California", "Louisiana", "Florida", "Montana", "Vermont"))
ppool_syn_time_summ_att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Collective Bargaining') +
xlab('Time') +
ylab('Expenditure on Pupil Estimate') +
facet_wrap(~Level)
ppool_syn_time_summ
ppool_syn_time_summ_att <- as.data.frame(ppool_syn_time_summ$att) %>% filter(Level %in% c("Hawaii", "California", "Louisiana", "Florida", "Montana", "Vermont"))
ppool_syn_time_summ_att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Collective Bargaining') +
xlab('Time') +
ylab('Expenditure on Pupil Estimate') +
facet_wrap(~Level)
ppool_syn_time_summ$att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Collective Bargaining') +
xlab('Time') +
ylab('Expenditure on Pupil Estimate') +
facet_wrap(~Level)
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 2,
time_cohort = TRUE)           # time cohort set to TRUE
# save summary
ppool_syn_time_summ <- summary(ppool_syn_time)
ppool_syn_time_summ
ppool_syn_time_summ$att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Adoption of Medicare') +
xlab('Time') +
ylab('Uninsured Estimate') +
facet_wrap(~Level)
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 4,
time_cohort = TRUE)           # time cohort set to TRUE
# save summary
ppool_syn_time_summ <- summary(ppool_syn_time)
ppool_syn_time_summ
ppool_syn_time_summ$att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Adoption of Medicare') +
xlab('Time') +
ylab('Uninsured Estimate') +
facet_wrap(~Level)
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 6,
time_cohort = TRUE)           # time cohort set to TRUE
# save summary
ppool_syn_time_summ <- summary(ppool_syn_time)
ppool_syn_time_summ
ppool_syn_time_summ$att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = 'None') +
ggtitle('Synthetic Controls for State Adoption of Medicare') +
xlab('Time') +
ylab('Uninsured Estimate') +
facet_wrap(~Level)
# Install and load packages
if (!require("pacman")) install.packages("pacman")
devtools::install_github("ebenmichael/augsynth")
pacman::p_load(# Tidyverse packages including dplyr and ggplot2
tidyverse,
ggthemes,
augsynth,
gsynth)
# set seed
set.seed(44)
# load data
medicaid_expansion <- read_csv('./data/medicaid_expansion.csv')
medicaid_expansion
# highest and lowest uninsured rates
pre2014 <- medicaid_expansion %>%
filter(year < 2014)
# Filter for the highest and lowest 5% using dplyr
lowest_5pct <- pre2014 %>%
filter(uninsured_rate <= quantile(uninsured_rate, 0.05))
highest_5pct <- pre2014 %>%
filter(uninsured_rate >= quantile(uninsured_rate, 0.95))
lowest_uninsured_states <- pull(distinct(lowest_5pct, State))
highest_uninsured_states <- pull(distinct(highest_5pct, State))
print(lowest_uninsured_states)
print(highest_uninsured_states)
# most uninsured Americans
pre2014 <-
pre2014 %>%
mutate(uninsured_pop = (pre2014$uninsured_rate * pre2014$population))
state_uninsured <-
pre2014 %>%
group_by(State) %>%
summarize(AvgUninsured = mean(uninsured_pop, na.rm = TRUE))
sorted_most <- state_uninsured %>%
arrange(desc(AvgUninsured), State)
sorted_least <- state_uninsured %>%
arrange(AvgUninsured, State)
sorted_most
sorted_least
medicaid2020 <-
filter(medicaid_expansion, year == 2020)
# Same analysis as above but with 2020 data
medicaid2020 <-
medicaid2020 %>%
mutate(uninsured_pop = (medicaid2020$uninsured_rate * medicaid2020$population))
state_uninsured2020 <-
medicaid2020 %>%
group_by(State) %>%
summarize(AvgUninsured = mean(uninsured_pop, na.rm = TRUE))
sorted_most2020 <- state_uninsured2020 %>%
arrange(desc(AvgUninsured), State)
sorted_least2020 <- state_uninsured2020 %>%
arrange(AvgUninsured, State)
sorted_most2020
sorted_least2020
head(medicaid_expansion, n = 60)
# Parallel Trends plotting
medicaid_expansion %>%
# process
# ---------
filter(State %in% c("Hawaii", "Pennsylvania")) %>%
# north dakota, kentucky, nevada, arizona, Date_Adopted %in% c("2016-01-01") |
# plot
# ---------
ggplot() +
geom_point(aes(x = year,
y = uninsured_rate,
color = State)) +
geom_line(aes(x = year,
y = uninsured_rate,
color = State)) +
geom_vline(xintercept = 2014, color = "maroon") +
geom_vline(xintercept = 2016, color = "darkgreen")
# themes
theme_fivethirtyeight() +
theme(axis.title = element_text()) +
# labels
ggtitle('States Enrolled on Jan 1, 2014 and Jan 1, 2016, \nbefore/after Enrollment') +
xlab('Year') +
ylab('Uninsured Rate')
# Difference-in-Differences estimation
# create a dataset for kansas and colorado
HI_PA <-
medicaid_expansion %>%
filter(State %in% c("Pennsylvania","Hawaii")) %>%
filter(year >= 2014 & year <= 2015)
# pre-treatment difference
# ----------
pre_diff <-
HI_PA %>%
# filter out only the year we want
filter(year == 2014) %>%
# subset to select only vars we want
select(State,
uninsured_rate) %>%
# make the data wide
pivot_wider(names_from = State,
values_from = uninsured_rate) %>%
# subtract to make calculation
summarise(Pennsylvania - Hawaii)
# post-treatment difference
# ----------
post_diff <-
HI_PA %>%
# filter out only the quarter we want
filter(year == 2015) %>%
# subset to select only vars we want
select(State,
uninsured_rate) %>%
# make the data wide
pivot_wider(names_from = State,
values_from = uninsured_rate) %>%
# subtract to make calculation
summarise(Pennsylvania - Hawaii)
# diff-in-diffs
# ----------
diff_in_diffs <- post_diff - pre_diff
diff_in_diffs
colnames(medicaid_expansion)
# add treatment effect
medicaid_expansion <-
medicaid_expansion %>%
# create new treatment flag just to see
mutate(treatment = case_when(State == "Virginia" & year >= 2019 ~ 1, # note this adds treatment in 2016
TRUE ~ 0))
# view head
head(medicaid_expansion)
# Install and load packages
if (!require("pacman")) install.packages("pacman")
devtools::install_github("ebenmichael/augsynth")
pacman::p_load(# Tidyverse packages including dplyr and ggplot2
tidyverse,
ggthemes,
augsynth,
gsynth)
# set seed
set.seed(44)
# load data
medicaid_expansion <- read_csv('./data/medicaid_expansion.csv')
medicaid_expansion
# highest and lowest uninsured rates
pre2014 <- medicaid_expansion %>%
filter(year < 2014)
# Filter for the highest and lowest 5% using dplyr
lowest_5pct <- pre2014 %>%
filter(uninsured_rate <= quantile(uninsured_rate, 0.05))
highest_5pct <- pre2014 %>%
filter(uninsured_rate >= quantile(uninsured_rate, 0.95))
lowest_uninsured_states <- pull(distinct(lowest_5pct, State))
highest_uninsured_states <- pull(distinct(highest_5pct, State))
print(lowest_uninsured_states)
print(highest_uninsured_states)
# most uninsured Americans
pre2014 <-
pre2014 %>%
mutate(uninsured_pop = (pre2014$uninsured_rate * pre2014$population))
state_uninsured <-
pre2014 %>%
group_by(State) %>%
summarize(AvgUninsured = mean(uninsured_pop, na.rm = TRUE))
sorted_most <- state_uninsured %>%
arrange(desc(AvgUninsured), State)
sorted_least <- state_uninsured %>%
arrange(AvgUninsured, State)
sorted_most
sorted_least
medicaid2020 <-
filter(medicaid_expansion, year == 2020)
# Same analysis as above but with 2020 data
medicaid2020 <-
medicaid2020 %>%
mutate(uninsured_pop = (medicaid2020$uninsured_rate * medicaid2020$population))
state_uninsured2020 <-
medicaid2020 %>%
group_by(State) %>%
summarize(AvgUninsured = mean(uninsured_pop, na.rm = TRUE))
sorted_most2020 <- state_uninsured2020 %>%
arrange(desc(AvgUninsured), State)
sorted_least2020 <- state_uninsured2020 %>%
arrange(AvgUninsured, State)
sorted_most2020
sorted_least2020
head(medicaid_expansion, n = 60)
# Parallel Trends plotting
medicaid_expansion %>%
# process
# ---------
filter(State %in% c("Hawaii", "Pennsylvania")) %>%
# north dakota, kentucky, nevada, arizona, Date_Adopted %in% c("2016-01-01") |
# plot
# ---------
ggplot() +
geom_point(aes(x = year,
y = uninsured_rate,
color = State)) +
geom_line(aes(x = year,
y = uninsured_rate,
color = State)) +
geom_vline(xintercept = 2014, color = "maroon") +
geom_vline(xintercept = 2016, color = "darkgreen")
# themes
theme_fivethirtyeight() +
theme(axis.title = element_text()) +
# labels
ggtitle('States Enrolled on Jan 1, 2014 and Jan 1, 2016, \nbefore/after Enrollment') +
xlab('Year') +
ylab('Uninsured Rate')
# Difference-in-Differences estimation
# create a dataset for kansas and colorado
HI_PA <-
medicaid_expansion %>%
filter(State %in% c("Pennsylvania","Hawaii")) %>%
filter(year >= 2014 & year <= 2015)
# pre-treatment difference
# ----------
pre_diff <-
HI_PA %>%
# filter out only the year we want
filter(year == 2014) %>%
# subset to select only vars we want
select(State,
uninsured_rate) %>%
# make the data wide
pivot_wider(names_from = State,
values_from = uninsured_rate) %>%
# subtract to make calculation
summarise(Pennsylvania - Hawaii)
# post-treatment difference
# ----------
post_diff <-
HI_PA %>%
# filter out only the quarter we want
filter(year == 2015) %>%
# subset to select only vars we want
select(State,
uninsured_rate) %>%
# make the data wide
pivot_wider(names_from = State,
values_from = uninsured_rate) %>%
# subtract to make calculation
summarise(Pennsylvania - Hawaii)
# diff-in-diffs
# ----------
diff_in_diffs <- post_diff - pre_diff
diff_in_diffs
colnames(medicaid_expansion)
# add treatment effect
medicaid_expansion <-
medicaid_expansion %>%
# create new treatment flag just to see
mutate(treatment = case_when(State == "Virginia" & year >= 2019 ~ 1, # note this adds treatment in 2016
TRUE ~ 0))
# view head
head(medicaid_expansion)
# non-augmented synthetic control
syn <-                              # save object
augsynth(uninsured_rate ~ treatment, # treatment - use instead of treated bc latter codes 2012.25 as treated
State,     # unit
year,  # time
medicaid_expansion,    # data
progfunc = "None",       # plain syn control
scm = T)                 # synthetic control
# summary to show average ATT and L2 imbalance
summary(syn)
# Plot differences
plot(syn)
virginia_synvirginia %>% filter((State == 'Virginia' ) & (year >= 2019))
syn_sum <- summary(syn)
# create synthetic Virginia
# ---------
virginia_synvirginia <-
# data
medicaid_expansion %>%
# filter just Kansas
filter(State == "Virginia") %>%
# bind columns
bind_cols(difference = syn_sum$att$Estimate) %>%# add in estimate
# calculate synthetic Virginia
mutate(synthetic_virginia = uninsured_rate + difference) # adds the estimate to the observed Kansas to create synthetic Virginia
# plot
# ---------
virginia_synvirginia %>%
ggplot() +
# ---------
geom_line(aes(x = year,
y = uninsured_rate,
color = 'Virginia')) +
# synthetic Virginia
# ---------
geom_line(aes(x = year,
y = synthetic_virginia,
color = 'Synthetic Virginia')) +
scale_color_manual(values = c('Virginia' = 'red', 'Synthetic Virginia' = 'blue')) +
geom_vline(aes(xintercept = 2019)) +
theme_fivethirtyeight() +
theme(axis.title = element_text()) +
ggtitle('Virginia vs Synthetic Virginia') +
xlab('Year') +
ylab('Uninsured Rate')
# augmented synthetic control
ridge_syn <-
augsynth(uninsured_rate ~ treatment,
State,
year,
medicaid_expansion,
progfunc = "ridge",  # specify
scm = T)
summary(ridge_syn)
# barplots of weights
# ----------------------------------------------------------------
data.frame(ridge_syn$weights) %>%
tibble::rownames_to_column('State') %>%
ggplot() +
geom_bar(aes(x = State, y = ridge_syn.weights),
stat = 'identity') +
coord_flip() + # coord flip
theme_fivethirtyeight() +
theme(axis.title = element_text()) +
ggtitle('Synthetic Control Weights') +
xlab('State') +
ylab('Weight')
# multisynth model states
# Removing Massachusetts & add new treatment variable
medicaid_expansion_clean <- medicaid_expansion %>%
filter(!State == "Massachusetts") %>%
# create "treatment" - year collective bargaining was adopted
mutate(Date_Adopted = ifelse(is.na(Date_Adopted),
Inf, Date_Adopted),
adopted = 1 * (year >= as.numeric(format(as.Date(Date_Adopted, format = "%Y-%m-%d"), "%Y"))))
medicaid_expansion_clean
# Multisynth model states
# ---------
# Setting nu to 0 to treat each state individually
no_pool_syn <- multisynth(uninsured_rate ~ adopted,
State,                       # unit
year,                        # time
nu = 0,                    # no pooling
medicaid_expansion_clean, # data
n_leads = 2)
no_pool_synsum <- summary(no_pool_syn)
no_pool_synsum$att
# ---------
no_pool_synsum_filt_att <- as.data.frame(no_pool_synsum$att) %>% filter(Level %in% c("Hawaii", "California", "Louisiana", "Florida", "Montana", "Vermont"))
no_pool_synsum_filt_att %>%
ggplot(aes(x = Time, y = Estimate, color = Level)) +
geom_point() +
geom_line() +
geom_vline(xintercept = 0) +
theme_fivethirtyeight() +
theme(axis.title = element_text(),
legend.position = "bottom") +
ggtitle('Synthetic Controls for State Medicaid Expansion') +
xlab('Time') +
ylab('Uninsured Estimate')
# multisynth model time cohorts
# ----------------------------------------------------------------
ppool_syn_time <- multisynth(uninsured_rate ~ adopted,
State,
year,
medicaid_expansion_clean,
n_leads = 6,
time_cohort = TRUE)           # time cohort set to TRUE
# save summary
ppool_syn_time_summ <- summary(ppool_syn_time)
ppool_syn_time_summ
